@page "/edit-brand/{BrandId:int}"
@using ProksRent_WebAPI.DTOs
@using ProksRent_WebAPI.Services
@using Microsoft.JSInterop
@inject IBrandService BrandService
@inject NavigationManager NavigationManager
@inject IJSRuntime JS

<PageTitle>@(BrandId == 0 ? "Add Brand" : "Edit Brand")</PageTitle>

<EditForm Model="brandDto" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label for="Name">Name:</label>
        <InputText id="Name" class="form-control" @bind="brandDto.Name" />
    </div>
    <div>
        <button type="submit" class="btn btn-primary mt-2">Save</button>
    </div>
</EditForm>

@code {
    [Parameter] public int BrandId { get; set; }
    private BrandDto brandDto = new();

    protected override async Task OnInitializedAsync()
    {
        if (BrandId != 0)
        {
            var existing = await BrandService.GetBrandByIdAsync(BrandId);
            if (existing != null) brandDto = existing;
        }
    }

    private async Task HandleValidSubmit()
    {
        try
        {
            if (BrandId == 0)
                await BrandService.AddBrandAsync(brandDto);
            else
                await BrandService.UpdateBrandAsync(brandDto);

            NavigationManager.NavigateTo("/brands");
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", "An error occurred while saving the brand.");
        }
    }
}